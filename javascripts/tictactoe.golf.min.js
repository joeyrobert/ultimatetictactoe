function newGameState(){for(board=[],gameWinners=[],i=0;i<9;i++)for(gameWinners[i]=void 0,j=0;j<9;j++)board[i][j]=void 0;turn="x",movecount=0,activeGame=void 0,gamePaused=!0,mode=void 0}function bindEvents(){$(window).resize(resize),$(".square").click(clickSquare),$("#playagain").click(playAgain),$("#zeroplayer").click(zeroPlayer),$("#oneplayer").click(onePlayer),$("#twoplayer").click(twoPlayer)}function zeroPlayer(){return mode=0,hideModal("intro"),gamePaused=!1,playRandomGame(),!1}function onePlayer(){return mode=1,hideModal("intro"),gamePaused=!1,!1}function twoPlayer(){return mode=2,hideModal("intro"),gamePaused=!1,!1}function hideModal(e){return $(".mymodal."+e).css({opacity:0}),setTimeout(function(){return function(){return $(".mymodal."+e).hide()}}(this),250)}function showModal(e){return $(".mymodal."+e).css({opacity:0,display:"block"}),$(".mymodal."+e).css({opacity:1})}function draw(){var e,a;return e="<div id='tictactoe' class='x'><% for(var i = 0; i < 9; i++) { %><div class='game <%-['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'][i] %>'><% for(var j = 0; j < 9; j++) { %><div data-i='<%-i %>' data-j='<%-j %>' class='square <%-['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'][j] %><% if(board[i][j]) { %><%-board[i][j] %><% } %>'></div><% } %><div class='winner'></div></div><% } %><div class='overallwinner mymodal'><span class='turn'></span><a href='#' id='playagain'>Play again?</a></div><div class='intro mymodal'><h3>New Game</h3><a href='#' id='zeroplayer' class='btn'>0 players</a><a href='#' id='oneplayer' class='btn'>1 player</a><a href='#' id='twoplayer' class='btn'>2 players</a></div></div>",a=_.template(e),$container=$("#tictactoecontainer"),$container.html(a({board:board}))}function resize(){var e,a,n,r;return r=$(window).width(),n=$(window).height(),a=$container.width(),e=$container.height(),scale=Math.min(a/450,e/450),$("#tictactoe").css({transform:"scale("+scale+")"})}function changeTurn(){return $("#tictactoe").removeClass(turn),turn="x"===turn?"o":"x",$("#tictactoe").addClass(turn)}function clickSquare(e){var a,n,r;return a=$(e.currentTarget),n=a.data("i"),r=a.data("j"),tictactoe(n,r)}function tictactoe(e,a){var n;return null==mode||gamePaused||board[e][a]||e!==activeGame&&activeGame||(n=$(".square[data-i="+e+"][data-j="+a+"]"),board[e][a]=turn,n.addClass(turn),n.html("x"===turn?"&#215;":"&#9675;"),movecount+=1,showWinners(turn,e),gamePaused||(activeGame=a,gameFull(board[a])&&(activeGame=void 0),showActiveGame(),changeTurn()),1!==mode||"o"!==turn)?void 0:playRandomSquare()}function showActiveGame(){null!=activeGame?($(".game").removeClass("active"),$(".game."+letters[activeGame]).addClass("active")):$(".game").addClass("active")}function gameFull(e){for(i=0;i<9;i++)if(!e[i])return!1;return!0}function showWinners(e,a){var n,r,t,i,o,l,s,c,d;for(o=findWinners(board[a],e),l=0,c=o.length;c>l;l++)for(i=o[l],s=0,d=i.length;d>s;s++)r=i[s],$(".game."+letters[a]+" .square."+letters[r]).addClass("won");o.length>0&&_.isUndefined(gameWinners[a])&&(gameWinners[a]=e,n=$(".game."+letters[a]),n.addClass("won").addClass(e),n.find(".winner").html("x"===e?"&#215;":"&#9675;")),t=findWinners(gameWinners,e),movecount>=81&&0===t.length?($(".game").removeClass("active"),gamePaused=!0,showWinnerModal(),null!=gameInterval&&clearInterval(gameInterval)):t.length>0&&($(".game").removeClass("active"),gamePaused=!0,showWinnerModal(e),null!=gameInterval&&clearInterval(gameInterval))}function showWinnerModal(e){$(".overallwinner .turn").html("x"===e?"&#215; won.":"o"===e?"&#9675; won.":"A tie!"),$(".overallwinner").removeClass("x"),$(".overallwinner").removeClass("o"),null!=e&&$(".overallwinner").addClass(e),$(".overallwinner").css({opacity:0,display:"block"}),$(".overallwinner").css({opacity:1}),$(".winner").css({opacity:1})}function findWinners(e,a){var n,r,t;for(t=[],e[0]===a&&e[4]===a&&e[8]===a&&t.push([0,4,8]),e[2]===a&&e[4]===a&&e[6]===a&&t.push([0,2,4]),r=0;3>r;r++)e[3*r]===a&&e[3*r+1]===a&&e[3*r+2]===a&&t.push([3*r,3*r+1,3*r+2]);for(n=0;3>n;n++)e[n]===a&&e[n+3]===a&&e[n+6]===a&&t.push([n,n+3,n+6]);return t}function playAgain(){return newGameState(),draw(),showActiveGame(),resize(),bindEvents(),!1}function playRandomGame(e){return null==e&&(e=!1),gameInterval=setInterval(function(){return function(){return playRandomSquare(),e?$("#playagain:visible").click():void 0}}(this),100)}function playRandomSquare(){var e,a;return e=$(".game.active .square:not(.x):not(.o)"),a=Math.floor(Math.random()*e.length),e.eq(a).click()}function init(){}letters=["A","B","C","D","E","F","G","H","I"],$(document).ready(function(){return newGameState(),init(),draw(),showActiveGame(),resize(),bindEvents()});