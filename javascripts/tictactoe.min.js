(function(){var t,e,i,a=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(){this.playRandomSquare=a(this.playRandomSquare,this),this.playRandomGame=a(this.playRandomGame,this),this.playAgain=a(this.playAgain,this),this.showWinnerModal=a(this.showWinnerModal,this),this.showActiveGame=a(this.showActiveGame,this),this.tictactoe=a(this.tictactoe,this),this.clickSquare=a(this.clickSquare,this),this.changeTurn=a(this.changeTurn,this),this.resize=a(this.resize,this),this.draw=a(this.draw,this),this.showModal=a(this.showModal,this),this.hideModal=a(this.hideModal,this),this.twoPlayer=a(this.twoPlayer,this),this.onePlayer=a(this.onePlayer,this),this.zeroPlayer=a(this.zeroPlayer,this),this.unbindEvents=a(this.unbindEvents,this),this.bindEvents=a(this.bindEvents,this),this.newGameState()}return t.prototype.newGameState=function(){var t,e,i,a,n;for(this.board=[],this.gameWinners=[],t=a=0;9>a;t=++a)for((i=this.board)[t]||(i[t]=[]),this.gameWinners[t]=void 0,e=n=0;9>n;e=++n)this.board[t][e]=void 0;return this.turn="x",this.movecount=0,this.activeGame=void 0,this.gamePaused=!0,this.mode=void 0},t.prototype.bindEvents=function(){return $(window).resize(this.resize),$(".square").click(this.clickSquare),$("#playagain").click(this.playAgain),$("#zeroplayer").click(this.zeroPlayer),$("#oneplayer").click(this.onePlayer),$("#twoplayer").click(this.twoPlayer)},t.prototype.unbindEvents=function(){return $(window).off("resize",this.resize),$(".square").off("click",this.clickSquare),$("#playagain").off("click",this.playAgain),$("#zeroplayer").off("click",this.zeroPlayer),$("#oneplayer").off("click",this.onePlayer),$("#twoplayer").off("click",this.twoPlayer)},t.prototype.zeroPlayer=function(){return this.mode=0,this.hideModal("intro"),this.gamePaused=!1,this.playRandomGame(),!1},t.prototype.onePlayer=function(){return this.mode=1,this.hideModal("intro"),this.gamePaused=!1,!1},t.prototype.twoPlayer=function(){return this.mode=2,this.hideModal("intro"),this.gamePaused=!1,!1},t.prototype.hideModal=function(t){return $(".mymodal."+t).css({opacity:0}),setTimeout(function(){return function(){return $(".mymodal."+t).hide()}}(this),250)},t.prototype.showModal=function(t){return $(".mymodal."+t).css({opacity:0,display:"block"}),$(".mymodal."+t).css({opacity:1})},t.prototype.draw=function(){var t,e;return t='<div id="tictactoe" class="x">\n  <% for(var i = 0; i < 9; i++) { %>\n    <div class="game <%-[\'A\', \'B\', \'C\', \'D\', \'E\', \'F\', \'G\', \'H\', \'I\'][i] %>">\n      <% for(var j = 0; j < 9; j++) { %>\n        <div data-i="<%-i %>" data-j="<%-j %>" class="square <%-[\'A\', \'B\', \'C\', \'D\', \'E\', \'F\', \'G\', \'H\', \'I\'][j] %><% if(board[i][j]) { %> <%-board[i][j] %><% } %>"></div>\n      <% } %>\n      <div class="winner"></div>\n    </div>\n  <% } %>\n  <div class="overallwinner mymodal">\n    <span class="turn"></span>\n    <a href="#" id="playagain">Play again?</a>\n  </div>\n  <div class="intro mymodal">\n    <h3>New Game</h3>\n    <a href="#" id="zeroplayer" class="btn">0 players</a>\n    <a href="#" id="oneplayer" class="btn">1 player</a>\n    <a href="#" id="twoplayer" class="btn">2 players</a>\n  </div>\n</div>',e=_.template(t),this.$container=$("#tictactoecontainer"),this.$container.html(e({board:this.board}))},t.prototype.resize=function(){var t,e,i,a;return a=$(window).width(),i=$(window).height(),e=this.$container.width(),t=this.$container.height(),this.scale=Math.min(e/450,t/450),$("#tictactoe").css({transform:"scale("+this.scale+")"})},t.prototype.changeTurn=function(){return $("#tictactoe").removeClass(this.turn),this.turn="x"===this.turn?"o":"x",$("#tictactoe").addClass(this.turn)},t.prototype.clickSquare=function(t){var e,i,a;return e=$(t.currentTarget),i=e.data("i"),a=e.data("j"),this.tictactoe(i,a)},t.prototype.tictactoe=function(t,e){var i;return null==this.mode||this.gamePaused||!_.isUndefined(this.board[t][e])||t!==this.activeGame&&!_.isUndefined(this.activeGame)||(i=$(".square[data-i="+t+"][data-j="+e+"]"),this.board[t][e]=this.turn,i.addClass(this.turn),i.html("x"===this.turn?"&#215;":"&#9675;"),this.movecount+=1,this.showWinners(this.turn,t),this.gamePaused||(this.activeGame=e,this.gameFull(this.board[e])&&(this.activeGame=void 0),this.showActiveGame(),this.changeTurn()),1!==this.mode||"o"!==this.turn)?void 0:this.playRandomSquare()},t.prototype.letters=["A","B","C","D","E","F","G","H","I"],t.prototype.showActiveGame=function(){return null!=this.activeGame?($(".game").removeClass("active"),$(".game."+this.letters[this.activeGame]).addClass("active")):$(".game").addClass("active")},t.prototype.gameFull=function(t){var e,i;for(e=i=0;9>i;e=++i)if(_.isUndefined(t[e]))return!1;return!0},t.prototype.showWinners=function(t,e){var i,a,n,s,r,o,h,l,c;for(r=this.findWinners(this.board[e],t),o=0,l=r.length;l>o;o++)for(s=r[o],h=0,c=s.length;c>h;h++)a=s[h],$(".game."+this.letters[e]+" .square."+this.letters[a]).addClass("won");if(r.length>0&&_.isUndefined(this.gameWinners[e])&&(this.gameWinners[e]=t,i=$(".game."+this.letters[e]),i.addClass("won").addClass(t),i.find(".winner").html("x"===t?"&#215;":"&#9675;")),n=this.findWinners(this.gameWinners,t),this.movecount>=81&&0===n.length){if($(".game").removeClass("active"),this.gamePaused=!0,this.showWinnerModal(),null!=this.gameInterval)return clearInterval(this.gameInterval)}else if(n.length>0&&($(".game").removeClass("active"),this.gamePaused=!0,this.showWinnerModal(t),null!=this.gameInterval))return clearInterval(this.gameInterval)},t.prototype.showWinnerModal=function(t){return $(".overallwinner .turn").html("x"===t?"&#215; won.":"o"===t?"&#9675; won.":"A tie!"),$(".overallwinner").removeClass("x"),$(".overallwinner").removeClass("o"),null!=t&&$(".overallwinner").addClass(t),$(".overallwinner").css({opacity:0,display:"block"}),$(".overallwinner").css({opacity:1}),$(".winner").css({opacity:1})},t.prototype.findWinners=function(t,e){var i,a,n,s,r;for(n=[],t[0]===e&&t[4]===e&&t[8]===e&&n.push([0,4,8]),t[2]===e&&t[4]===e&&t[6]===e&&n.push([0,2,4]),a=s=0;3>s;a=++s)t[3*a]===e&&t[3*a+1]===e&&t[3*a+2]===e&&n.push([3*a,3*a+1,3*a+2]);for(i=r=0;3>r;i=++r)t[i]===e&&t[i+3]===e&&t[i+6]===e&&n.push([i,i+3,i+6]);return n},t.prototype.playAgain=function(){return this.newGameState(),this.draw(),this.showActiveGame(),this.resize(),this.bindEvents(),!1},t.prototype.playRandomGame=function(t){return null==t&&(t=!1),this.gameInterval=setInterval(function(e){return function(){return e.playRandomSquare(),t?$("#playagain:visible").click():void 0}}(this),100)},t.prototype.playRandomSquare=function(){var t,e;return t=$(".game.active .square:not(.x):not(.o)"),e=Math.floor(Math.random()*t.length),t.eq(e).click()},t}(),i=function(t){var e,i;return i=t.changedTouches[0],e=document.createEvent("MouseEvent"),e.initMouseEvent({touchstart:"click",touchmove:"mousemove",touchend:"mouseup"}[t.type],!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(e),t.preventDefault()},e=function(){return document.addEventListener("touchstart",i,!0)},$(document).ready(function(){var i;return i=new t,e(),i.draw(),i.showActiveGame(),i.resize(),i.bindEvents()})}).call(this);